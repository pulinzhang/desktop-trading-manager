# ç¨‹åºè¿è¡Œæµç¨‹è¯¦è§£

## ğŸ“‹ æ•´ä½“æ¶æ„

è¿™æ˜¯ä¸€ä¸ª **Electron** åº”ç”¨ï¼Œåˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
- **ä¸»è¿›ç¨‹ï¼ˆMain Processï¼‰**ï¼š`src/main/index.ts` - æ§åˆ¶åº”ç”¨çª—å£å’Œç³»ç»Ÿäº¤äº’
- **æ¸²æŸ“è¿›ç¨‹ï¼ˆRenderer Processï¼‰**ï¼š`src/renderer/` - æ˜¾ç¤ºç”¨æˆ·ç•Œé¢ï¼ˆReact åº”ç”¨ï¼‰

---

## ğŸš€ ç¨‹åºå¯åŠ¨é¡ºåº

### ç¬¬ä¸€æ­¥ï¼šElectron ä¸»è¿›ç¨‹å¯åŠ¨
**æ–‡ä»¶ï¼š`src/main/index.ts`**

```
1. Electron åº”ç”¨å¯åŠ¨
   â†“
2. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆinitDatabaseï¼‰
   â†“
3. åˆ›å»ºæµè§ˆå™¨çª—å£ï¼ˆcreateWindowï¼‰
   â†“
4. åŠ è½½ HTML æ–‡ä»¶ï¼ˆindex.htmlï¼‰
```

**å…³é”®ä»£ç ï¼š**
```typescript
// åˆ›å»ºçª—å£å¹¶åŠ è½½é¡µé¢
mainWindow.loadURL('http://localhost:5173/')  // å¼€å‘ç¯å¢ƒ
// æˆ–
mainWindow.loadFile('index.html')  // ç”Ÿäº§ç¯å¢ƒ
```

---

### ç¬¬äºŒæ­¥ï¼šHTML é¡µé¢åŠ è½½
**æ–‡ä»¶ï¼š`src/renderer/index.html`**

```html
<body>
  <div id="root"></div>  <!-- React åº”ç”¨å°†æŒ‚è½½åˆ°è¿™é‡Œ -->
  <script type="module" src="./src/main.tsx"></script>  <!-- å¯åŠ¨ React -->
</body>
```

**ä½œç”¨ï¼š**
- æä¾›ä¸€ä¸ªå®¹å™¨ `<div id="root">` ç»™ React
- åŠ è½½ `main.tsx` ä½œä¸ºå…¥å£è„šæœ¬

---

### ç¬¬ä¸‰æ­¥ï¼šReact åº”ç”¨åˆå§‹åŒ–
**æ–‡ä»¶ï¼š`src/renderer/src/main.tsx`**

```typescript
// 1. å¯¼å…¥å¿…è¦çš„æ¨¡å—
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'
import './i18n'  // åˆå§‹åŒ–å›½é™…åŒ–
import './index.css'  // åŠ è½½æ ·å¼

// 2. æ‰¾åˆ° HTML ä¸­çš„ root å…ƒç´ 
// 3. å°† <App /> ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š
ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

**æ‰§è¡Œé¡ºåºï¼š**
1. âœ… åˆå§‹åŒ–å›½é™…åŒ–ç³»ç»Ÿï¼ˆi18nï¼‰
2. âœ… åŠ è½½å…¨å±€æ ·å¼
3. âœ… æ‰¾åˆ° `#root` å…ƒç´ 
4. âœ… æ¸²æŸ“ `<App />` ç»„ä»¶

---

### ç¬¬å››æ­¥ï¼šApp ç»„ä»¶å†³å®šæ˜¾ç¤ºä»€ä¹ˆ
**æ–‡ä»¶ï¼š`src/renderer/src/App.tsx`**

```typescript
function App() {
  // ä»çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰ä¸­è·å–ç™»å½•çŠ¶æ€
  const { isAuthenticated } = useAuthStore()

  return (
    <ConfigProvider theme={...}>
      {/* å…³é”®åˆ¤æ–­ï¼šå¦‚æœæœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•é¡µé¢ï¼›å¦åˆ™æ˜¾ç¤ºä»ªè¡¨æ¿ */}
      {!isAuthenticated ? <Login /> : <Dashboard />}
    </ConfigProvider>
  )
}
```

**é€»è¾‘è¯´æ˜ï¼š**
- ğŸ“Œ `useAuthStore()` ä»å…¨å±€çŠ¶æ€ä¸­è¯»å– `isAuthenticated`
- ğŸ“Œ åˆå§‹çŠ¶æ€ï¼š`isAuthenticated = false`ï¼ˆè§ `useAuthStore.ts` ç¬¬ 30 è¡Œï¼‰
- ğŸ“Œ å› ä¸º `!isAuthenticated` ä¸º `true`ï¼Œæ‰€ä»¥æ˜¾ç¤º `<Login />` ç»„ä»¶

---

### ç¬¬äº”æ­¥ï¼šLogin ç»„ä»¶æ¸²æŸ“
**æ–‡ä»¶ï¼š`src/renderer/src/components/Login/Login.tsx`**

**ä¸ºä»€ä¹ˆ Login.tsx ä¼šè¿è¡Œï¼Ÿ**

1. **åˆå§‹çŠ¶æ€æ£€æŸ¥**
   ```typescript
   // useAuthStore.ts ç¬¬ 27-32 è¡Œ
   export const useAuthStore = create<AuthStore>((set, get) => ({
     user: null,              // ç”¨æˆ·ä¿¡æ¯ä¸ºç©º
     settings: null,          // è®¾ç½®ä¸ºç©º
     isAuthenticated: false,  // â­ ç™»å½•çŠ¶æ€ä¸º false
     loading: false,
     error: null,
   }))
   ```

2. **App.tsx çš„æ¡ä»¶æ¸²æŸ“**
   ```typescript
   // App.tsx ç¬¬ 21 è¡Œ
   {!isAuthenticated ? <Login /> : <Dashboard />}
   // å› ä¸º isAuthenticated = false
   // æ‰€ä»¥ !isAuthenticated = true
   // å› æ­¤æ˜¾ç¤º <Login />
   ```

3. **Login ç»„ä»¶çš„ä½œç”¨**
   - æ˜¾ç¤ºç™»å½•/æ³¨å†Œè¡¨å•
   - å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆé‚®ç®±ã€å¯†ç ï¼‰
   - è°ƒç”¨ `login()` æˆ– `register()` å‡½æ•°
   - ç™»å½•æˆåŠŸåï¼Œ`isAuthenticated` å˜ä¸º `true`ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ° `<Dashboard />`

---

## ğŸ”„ çŠ¶æ€å˜åŒ–æµç¨‹

### ç”¨æˆ·ç™»å½•æ—¶çš„æµç¨‹ï¼š

```
1. ç”¨æˆ·åœ¨ Login.tsx ä¸­è¾“å…¥é‚®ç®±å’Œå¯†ç 
   â†“
2. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
   â†“
3. è°ƒç”¨ useAuthStore().login(email, password)
   â†“
4. useAuthStore.ts æ‰§è¡Œç™»å½•é€»è¾‘ï¼š
   - è°ƒç”¨ window.electronAPI.login()ï¼ˆä¸ä¸»è¿›ç¨‹é€šä¿¡ï¼‰
   - éªŒè¯æˆåŠŸåï¼Œè®¾ç½® user å’Œ isAuthenticated = true
   â†“
5. React æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–ï¼Œé‡æ–°æ¸²æŸ“ App.tsx
   â†“
6. å› ä¸º isAuthenticated = trueï¼Œæ¡ä»¶åˆ¤æ–­å˜ä¸ºï¼š
   {!isAuthenticated ? <Login /> : <Dashboard />}
   // !true = falseï¼Œæ‰€ä»¥æ˜¾ç¤º <Dashboard />
   â†“
7. Login ç»„ä»¶è¢«å¸è½½ï¼ŒDashboard ç»„ä»¶è¢«æ¸²æŸ“
```

---

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

```
å¯åŠ¨åº”ç”¨
   â”‚
   â”œâ”€â†’ Electron ä¸»è¿›ç¨‹å¯åŠ¨ (src/main/index.ts)
   â”‚      â”‚
   â”‚      â”œâ”€â†’ åˆå§‹åŒ–æ•°æ®åº“
   â”‚      â”‚
   â”‚      â””â”€â†’ åˆ›å»ºçª—å£å¹¶åŠ è½½ index.html
   â”‚
   â”œâ”€â†’ HTML åŠ è½½ (index.html)
   â”‚      â”‚
   â”‚      â””â”€â†’ åŠ è½½ main.tsx è„šæœ¬
   â”‚
   â”œâ”€â†’ React åˆå§‹åŒ– (main.tsx)
   â”‚      â”‚
   â”‚      â”œâ”€â†’ åˆå§‹åŒ– i18nï¼ˆå›½é™…åŒ–ï¼‰
   â”‚      â”‚
   â”‚      â””â”€â†’ æ¸²æŸ“ <App /> ç»„ä»¶
   â”‚
   â”œâ”€â†’ App ç»„ä»¶æ¸²æŸ“ (App.tsx)
   â”‚      â”‚
   â”‚      â”œâ”€â†’ è¯»å– useAuthStore().isAuthenticated
   â”‚      â”‚      â”‚
   â”‚      â”‚      â””â”€â†’ åˆå§‹å€¼ï¼šfalse
   â”‚      â”‚
   â”‚      â””â”€â†’ æ¡ä»¶åˆ¤æ–­ï¼š!isAuthenticated
   â”‚             â”‚
   â”‚             â”œâ”€â†’ true  â†’ æ˜¾ç¤º <Login />
   â”‚             â”‚
   â”‚             â””â”€â†’ false â†’ æ˜¾ç¤º <Dashboard />
   â”‚
   â””â”€â†’ Login ç»„ä»¶æ˜¾ç¤º
          â”‚
          â””â”€â†’ ç­‰å¾…ç”¨æˆ·ç™»å½•...
```

---

## ğŸ¯ å…³é”®æ¦‚å¿µè§£é‡Š

### 1. **çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰**
- `useAuthStore` æ˜¯ä¸€ä¸ªå…¨å±€çŠ¶æ€ç®¡ç†å™¨
- æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥è¯»å–å’Œä¿®æ”¹è¿™ä¸ªçŠ¶æ€
- å½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œä½¿ç”¨è¯¥çŠ¶æ€çš„ç»„ä»¶ä¼šè‡ªåŠ¨é‡æ–°æ¸²æŸ“

### 2. **æ¡ä»¶æ¸²æŸ“**
```typescript
{!isAuthenticated ? <Login /> : <Dashboard />}
```
è¿™æ˜¯ React çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œç›¸å½“äºï¼š
```typescript
if (!isAuthenticated) {
  æ˜¾ç¤º <Login />
} else {
  æ˜¾ç¤º <Dashboard />
}
```

### 3. **ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ**
- **æŒ‚è½½ï¼ˆMountï¼‰**ï¼šç»„ä»¶ç¬¬ä¸€æ¬¡æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
- **æ›´æ–°ï¼ˆUpdateï¼‰**ï¼šç»„ä»¶çŠ¶æ€æˆ–å±æ€§æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“
- **å¸è½½ï¼ˆUnmountï¼‰**ï¼šç»„ä»¶ä»é¡µé¢ç§»é™¤

å½“ç”¨æˆ·ç™»å½•åï¼š
- `Login` ç»„ä»¶ä¼šè¢«å¸è½½
- `Dashboard` ç»„ä»¶ä¼šè¢«æŒ‚è½½

---

## ğŸ’¡ æ€»ç»“

**ä¸ºä»€ä¹ˆ Login.tsx ä¼šè¿è¡Œï¼Ÿ**

1. âœ… åº”ç”¨å¯åŠ¨æ—¶ï¼Œ`isAuthenticated` çš„åˆå§‹å€¼æ˜¯ `false`
2. âœ… `App.tsx` æ£€æŸ¥ `!isAuthenticated`ï¼Œç»“æœä¸º `true`
3. âœ… å› æ­¤æ˜¾ç¤º `<Login />` ç»„ä»¶
4. âœ… ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œ`isAuthenticated` å˜ä¸º `true`
5. âœ… `App.tsx` é‡æ–°æ¸²æŸ“ï¼Œæ˜¾ç¤º `<Dashboard />` ç»„ä»¶

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ çœ‹åˆ°çš„æ˜¯ç™»å½•é¡µé¢ï¼Œè€Œä¸æ˜¯ä»ªè¡¨æ¿ï¼

